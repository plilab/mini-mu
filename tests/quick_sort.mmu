import "std_nat" (lt, geq)
import "std_list" (list_append)

def list_split pred xs cpr k :=
  xs . { Nil -> (Nil, Nil) . k
       | List:: x xs' ->
            seq rest <- list_split pred xs' cpr
            then rest . { (smaller, greater) ->
              pred @ x cpr { True -> ((List:: x smaller), greater) . k
                           | False -> (smaller, (List:: x greater)) . k } } };

def quick_sort xs k :=
  xs . { Nil -> Nil . k
       | List:: pivot xs' ->
            seq
              (smaller, greater) <- list_split lt xs' pivot,
              sorted_s <- quick_sort smaller,
              sorted_g <- quick_sort greater
            then list_append @ sorted_s (List:: pivot sorted_g) k };

run quick_sort @ (List:: 3 (List:: 1 (List:: 2 (List:: 0 (List:: 3 (List:: 1 (List:: 2 (List:: 0 Nil)))))))) halt
