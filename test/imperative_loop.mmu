def list_map f xs k :=
  xs . [ Nil -> Nil . k
        | List:: x xs' -> 
            do
              y <- f x,
              ys' <- list_map f xs',
            then List:: y ys' . k ];

def inc x k := S x . k;

def lt a b k := 
  a . [ Z -> b . [ Z -> False . k | S b' -> True . k ]
       | S a' -> b . [ Z -> False . k | S b' -> lt @ a' b' k ] ];

for_loop = mu[ Ap5 i end xs body k ->
  < lt |> Ap3 i end mu[ is_less ->
    < is_less |> mu[ True ->
                      < body |> Ap3 i xs mu[ xs' ->
                          < S i |> mu[ i_next -> < for_loop |> Ap5 i_next end xs' body k > ] > ] >
                   | False -> < xs |> k > ] > ] > ];

map_once = mu[ Ap3 i xs k -> < list_map |> Ap3 inc xs k > ];

main = mu[ Halt ->
    < for_loop |> Ap5 Z (S (S (S Z))) (List:: (S (S Z)) (List:: (S Z) (List:: Z Nil))) map_once Halt > ]